=======================
Plotting Best Practices
=======================

Visualisation plays a crucial role in assessing the accuracy of binding free energy calculations. The same
raw data can be represented in many different ways, and the choice of plot or analysis metric determines which aspects of performance are
highlighted. This page explains the plot types available in ``cinnabar``, and the best practices they follow. For more
detailed information we recommend reading the companion article [1]_.

Edgewise :math:`\Delta\Delta G` Plots
-------------------------------------

Edgewise relative free energy plots allow direct comparison of calculated and experimental :math:`\Delta\Delta G` values.
These plots are best for method developers, as they show how well individual transformations
are predicted and highlight outliers.

Best practices:

- **Only error statistics (RMSE, MUE)** are shown by default. Correlation measures (:math:`R^{2}`, :math:`\rho`) are not meaningful, as the direction of a relative transformation is arbitrary.
- **Error bars** are shown on to represent uncertainty in both calculated and experimental values.
- **Statistics uncertainty estimates** are bootstrapped (1000 samples with replacement) to provide 95% confidence intervals.


Absolute :math:`\Delta G` Plots
-------------------------------

Absolute free energy plots compare calculated and experimental :math:`\Delta G` values for each ligand. Absolute
:math:`\Delta G` predictions can be obtained from a connected network of relative free energies. They therefore accumulate errors from multipule aspects of the calculation, including
edge accuracy, uncertainty quantification, perturbation network design and estimator, giving a complete picture of protocol performance.
These plots are then useful for both method developers and users, as they show how well the overall ranking of ligands is predicted.

Best practices:

- **Both error (RMSE, MUE) and correlation** (:math:`R^{2}`, :math:`\rho`) statistics are shown by default, as absolute data are directional and correlation is meaningful.
- **Error bars** are shown on to represent uncertainty in both calculated and experimental values.
- **Statistics uncertainty estimates** are bootstrapped (1000 samples with replacement) to provide 95% confidence intervals.
- **Mean centering** is applied by default to align the mean of calculated and experimental values, as the absolute scale is arbitrary.

Pairwise (all-to-all) :math:`\Delta\Delta G` Plots
--------------------------------------------------

Pairwise or all-to-all relative free energy plots compare all possible pairwise :math:`\Delta\Delta G` values between ligands in a dataset.
These are generated by calculating pairwise differences from the estimated absolute :math:`\Delta G` values.
These plots are especially useful for method developers because they remove analysis biases introduced by the perturbation network design:
every method is compared on the same set of pairwise values, even if the underlying networks differ.

Best practices:

- Follow the same guidelines as for edgewise plots (error statistics only, with uncertainties represented).
- Use these plots for fair, network-independent comparisons between methods.


Summary of Best Practices
-------------------------

- Use :math:`\Delta\Delta G` plots for edge-level diagnostics.
- Use absolute :math:`\Delta G` plots for global performance and ranking.
- Always represent uncertainties, both at the individual estimate level and on reported statistics (e.g. RMSE).
- When comparing across methods, use all-to-all pairwise :math:`\Delta\Delta G` to enable fair comparisons.


References
~~~~~~~~~~~

.. [1] Hahn, D.F., Bayly, C.I., Boby, M.L., Macdonald, H.E.B., Chodera, J.D., Gapsys, V., Mey, A.S., Mobley, D.L., Benito, L.P., Schindler, C.E. and Tresadern, G., 2022. Best practices for constructing, preparing, and evaluating protein-ligand binding affinity benchmarks [article v1. 0]. Living journal of computational molecular science, 4(1), p.1497.

